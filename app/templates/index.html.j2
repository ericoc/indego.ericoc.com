<!DOCTYPE html>
<html lang="en">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="author" content="Eric O'Callaghan">
        <meta name="description" content="Philadelphia Indego Bikes">
        <meta name="keywords" content="ericoc, indego, philadelphia, philly, bikes, bikeshare, bicycles">
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="Philadelphia Indego Bikes">
        <meta property="og:title" content="Indego Bicycle Stations">
        <meta property="og:description" content="A quick and easy way to see available bicycles and docks throughout all Philadlephia Indego bicycle-share stations.">
        <meta property="og:url" content="{{ url_for('index', _external=True) }}">
        <meta property="og:image" content="{{ url_for('static', filename='icon.png', _external=True) }}">
        <link href="{{ url_for('static', filename='indego.css') }}" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="{{ url_for('static', filename='icon.png') }}">
        <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon.png') }}">
        <title>Indego Bikes!</title>
    </head>

    <body>
        <h1><a href="https://indegopy.ericoc.com/">Indego Bikes</a> <a href="https://xn--h78h.ericoc.com/">ðŸš²</a></h1><br>

        <form method="get" action="{{ url_for('search_form') }}">
            <input type="text" name="search"> <i>(i.e. "<a href="{{ url_for('search_stations', search_string='fairmount') }}">fairmount</a>" or "<a href="{{ url_for('search_stations', search_string='19107') }}">19107</a>")</i>
            <input type="submit" value="Search!">
        </form><br>

        <table>

            <tr class="header">
                <td>Kiosk ID</td>
                <td>Name</td>
                <td>Bikes</td>
                <td></td>
                <td>Docks</td>
                <td>History</td>
            </tr>

            {%- macro graph(count, character='â–ˆ') %}
              {%- if count > 0 -%}
                {%- for item in range(count) -%}{{ character }}{%- endfor -%}
              {%- endif -%}
            {%- endmacro %}

            {%- if indego_stations is defined and indego_stations != None and indego_stations is iterable and indego_stations|length > 0 %}
              {%- for indego_kiosk_id, indego_station in indego_stations.items() %}

            <tr id="{{ indego_kiosk_id }}">
                <td><a href="#{{ indego_kiosk_id }}">{{ indego_kiosk_id }}</a></td>
                <td><span title="{{ indego_station['addressStreet'] }} ({{ indego_station['addressZipCode'] }})">{{ indego_station['name'] }}</span></td>
                <td>{{ indego_station['bikesAvailable'] }}</td>
                <td>
                {%- if emoji %}
                  <span class="bikes">{{ graph(indego_station['bikesAvailable'], 'ðŸš² ') }}</span><span class="docks">{{ graph(indego_station['docksAvailable'], '-') }}</span>
                {%- else %}
                  <span class="bikes">{{ graph(indego_station['bikesAvailable']) }}</span><span class="docks">{{ graph(indego_station['docksAvailable']) }}</span>
                {%- endif %}
                </td>
                <td>{{ indego_station['docksAvailable'] }}</td>
                <td class="graphcol"><a href="#{{ indego_kiosk_id }}" target="popup" onclick="window.open('{{ url_for('chart_station', chart_string=indego_kiosk_id) }}','popup','width=800,height=500'); return false;">ðŸ“Š</a></td>
            </tr>
              {%- endfor %}

            {%- else %}
            <tr>
                <td align="center" colspan="6"><i>No active stations found!</i><td>
            </tr>
            {%- endif %}

            <tr class="header">
                <td>Totals</td>
                <td>{{ indego_stations | length }} station{%- if indego_stations | length != 1 -%}s{%- endif -%}</td>
                <td>{{ indego_stations.values() | sum(attribute='bikesAvailable') }}</td>
                <td></td>
                <td>{{ indego_stations.values() | sum(attribute='docksAvailable') }}</td>
                <td></td>
            </tr>

        </table><br>

        <pre>courtesy of <a href="https://www.rideindego.com/" target="_blank">Indego</a></pre><br>
        <pre><a href="https://github.com/ericoc/indegopy.ericoc.com/" target="_blank">view source @ github</a> | <a href="https://github.com/ericoc/indego-py-lib/" target="_blank">my Indego Python library</a></pre>

    </body>

</html>
