<!DOCTYPE html>
<html lang="en">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link href="/static/indego.css" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="/static/favicon.ico">
        <link rel="apple-touch-icon" href="/static/icon.png">
        <title>Indego Bikes!</title>
    </head>

    <body>
        <h1><a href="https://indegopy.ericoc.com/">Indego Bikes</a> <a href="https://xn--h78h.ericoc.com/">ðŸš²</a></h1><br>

        <form method="get" action="{{ url_for('search_form') }}">
            <input type="text" name="search"> <i>(i.e. "<a href="{{ url_for('search_stations', search_string='fairmount') }}">fairmount</a>" or "<a href="{{ url_for('search_stations', search_string='19107') }}">19107</a>")</i>
            <input type="submit" value="Search!">
        </form><br>

        <table>

            <tr class="header">
                <td>Kiosk ID</td>
                <td>Name</td>
                <td>Bikes</td>
                <td></td>
                <td>Docks</td>
                <td>History</td>
            </tr>

            {%- macro graph(count, character='â–ˆ') %}
              {%- if count > 0 -%}
                {%- for item in range(count) -%}{{ character }}{%- endfor -%}
              {%- endif -%}
            {%- endmacro %}

            {%- if indego_stations is defined and indego_stations != None %}
              {%- for indego_kiosk_id, indego_station in indego_stations.items() %}

            <tr id="{{ indego_kiosk_id }}">
                <td><a href="#{{ indego_kiosk_id }}">{{ indego_kiosk_id }}</a></td>
                <td><span title="{{ indego_station['name'] }} ({{ indego_station['addressZipCode'] }})">{{ indego_station['name'] }}</span></td>
                <td>{{ indego_station['bikesAvailable'] }}</td>
                <td>
                {%- if emoji %}
                  <span class="bikes">{{ graph(indego_station['bikesAvailable'], 'ðŸš² ') }}</span><span class="docks">{{ graph(indego_station['docksAvailable'], '-') }}</span>
                {%- else %}
                  <span class="bikes">{{ graph(indego_station['bikesAvailable']) }}</span><span class="docks">{{ graph(indego_station['docksAvailable']) }}</span>
                {%- endif %}
                </td>
                <td>{{ indego_station['docksAvailable'] }}</td>
                <td class="graphcol"><a target="popup" onclick="window.open('{{ url_for('chart_station', chart_string=indego_kiosk_id) }}','popup','width=800,height=500'); return false;">ðŸ“Š</a></td>
            </tr>
              {%- endfor %}

            <tr class="header">
                <td>Totals</td>
                <td>{{ indego_stations | length }} station{%- if indego_stations | length != 1 -%}s{%- endif -%}</td>
                <td>{{ indego_stations.values() | sum(attribute='bikesAvailable') }}</td>
                <td></td>
                <td>{{ indego_stations.values() | sum(attribute='docksAvailable') }}</td>
                <td></td>
            </tr>

            {%- else %}
            <tr>
                <td align="center" colspan="6"><i>No active stations found!</i><td>
            </tr>
            {%- endif %}

        </table><br>

        <pre>courtesy of <a href="https://www.rideindego.com/" target="_blank">Indego</a></pre><br>
        <pre><a href="https://github.com/ericoc/indegopy.ericoc.com/" target="_blank">view source @ github</a> | <a href="https://github.com/ericoc/indego-py-lib/" target="_blank">my Indego Python library</a></pre>

    </body>

</html>

